---
title: Paralelizācija ar CPU un GPU
---

Līdz šim mēs runājām par paralelizāciju izmantojot vairākus CPU jeb procesorus. Tas nozīmē, ka mēs sadalījām uzdevumu vairākos apakšuzdevumos un tos devām risināt vairākiem procesoriem. Mūsdienās procesori jau kļuvuši sarežģītāki un tajos nav vairs tikai viens skaitļošanas kodols, bet gan 2 vai 4 vai pat 8 kodoli un katrs no tiem var veikt uzdevumu. Tagad modernos CPU, ar kuriem būvē HPC klasterus jau ir pat 64 un vēl vairāk kodoli. Kodolu skaits jaunajos procesoros pakāpeniski palielinās. 
Tas nozīmē, ka šādiem CPU ar daudziem kodoliem var īstenot skaitļošanas paralelizāciju un to dara ar speciālām instrukcijām, kas paredzētas šādiem procesoriem.

# Instrukciju līmeņa paralelizācija

CPU kodoli veic virkni instrukciju, kad izpilda datorprogrammu. Piemēram, ielādē datus no galvenās atmiņas reģistrā un no reģistra saglabā datus galvenajā atmiņā. Vai arī instrukcija uzdod veikt datu saskaitīšanu vai reizināšanu vai kādu citu darbību.

Instrukciju veikšanas ātrumu nosaka takts frekvence. Piemēram, ja CPU darbināts ar takts frekvenci 2GHz, tad tas nozīmē, ka notiks 2 miljardi darbību vienā sekundē. Instrukciju līmeņa paralelizācija (Instruction-level parallelism) nozīmē to, ka **CPU ar saviem skaitļošanas kodoliem vienā taktī paralēli veiks daudzas darbības.**

Piemēram, ja procesorā ir 2 kodoli un ir jāveic 2 neatkarīgas saskaitīšanas operācijas, tad tās var veikt paraleli vienā taktī. Programmētājam gan nav iespēja pašam tieši veikt šādu paralelizēšanu, bet tomēr ar programmas kodu var to tomēr noorganizēt.

<img src="https://raw.githubusercontent.com/viktorszagorskis/hpc-pamati/main/pix/paralel10.png" width="600"/>

# Vektorizācija
 Iedomājieties, ka ir astoņi skaitļi vai matemātikas valodā tas varētu būt arī vektors ar astoņiem skaitļiem un mums tas būtu jāsasummē ar citu tikpat garu vektoru. **Vektorizācija nozīmē spēju skaitļošanas elementam veikt darbības vienlaicīgi ar vairākiem skaitļiem.** Attēlā ir parādīta šāda situācija. Piemēram, zaļais vektors tiek saskaitīts (vai reizināts vai vēl kāda cita darbība) ar zilo vektoru.

<img src="https://raw.githubusercontent.com/viktorszagorskis/hpc-pamati/main/pix/paralel11.png" width="600"/>

# GPU jeb grafiskais procesors

Attīstību nosaka pieprasījums un tā attīstījās arī skaitļošanas elementi. Sākumā no vakuuma lampām pārgāja uz tranzistoriem un mikroshēmām, lai paaugstinātu datoru veiktspēju. Tad sāka mainīties datoru pielietojumi un arvien vairāk sāka parādīties jaunas datoru pielietojumu jomas. Grafiskie procesori sāka attīstīties tad kad veidojās datorspēļu tirgus.

Datorspēļu tirgus ir tagad ļoti plašs un tur ir vajadzīgi specializēti procesori GPU, kas ļauj nodrošināt augstas kvalitātes 3D grafiku. GPU sāka attīstīties ap 1990tajiem gadiem. Sony firma 1994. gadā ieviesa terminu GPU jeb Graphical Processing Unit (grafiskais skaitļošanas mezgls) un gadsimta beigās tie sāka parādīties arī personālajos datoros.
Šajā gadsimtā GPU sāka izmantot arī superskaitļošanā un radās pat termins GPGPU, kas nozīmē vispārēja lietojuma GPU (General Purpose GPU). Zemāk **attēlā** ir salīdzināta CPU un GPU uzbūve.

CPU ir ar sarežģītāku uzbūvi, bet ar elastīgāku pielietojumu. Tas ir ātrdarbīgs, var vadīt datora operētājsistēmu un risināt daudzveidīgus uzdevumus, tam ir labāka vadības loģika, kešatmiņas un tas ir veidots plašas jomas uzdevumu risināšanai.
GPU savukārt ir specializēti veidots 3D attēlu apstrādei. Tajā ir vairāk skaitļošanas kodolu un pašiem jaunākajiem to skaits pat ir tūkstošos. **GPU pašu kodolu veiktspēja ir daudz vājāka nekā CPU, bet to lielais skaits ļauj paralēlajā skaitļošanā pārspēt CPU.** GPU ir arī lielāks piekļuves ātrums atmiņai un tiem ir labāka energoefektivitāte nekā CPU.

<img src="https://raw.githubusercontent.com/viktorszagorskis/hpc-pamati/main/pix/paralel12.png" width="600"/>

Diemžēl vienkāršotie GPU kodoli neļauj risināt daudzveidīgus zinātnes uzdevumus, tāpēc tie ir jāpavieno ar CPU un ar programmatūru jāatrod efektīvākie risinājumi. Redzam, ka specializēto īpašību dēļ, **GPU ir jāapvieno ar CPU**.

GPU nevar vadīt operāciju sistēmu, tāpēc darbu sāk CPU. Kad skaitļošana ir uzsākta, tad ātrdarbībai pieslēdz GPU, un reizēm tos sauc par paātrinātājiem. Arī atmiņas CPU un GPU ir katram sava, tāpēc dati no CPU atmiņas ir jāpārkopē uz GPU atmiņu. Kad CPU veic datu apstrādi pēc GPU paveiktā, tad atkal dati ir jāpārkopē atpakaļ. Programmētājam tas ir jāņem vērā, jo datu pārkopēšana ir lēnāka, nekā pati skaitļošana.

Neskatoties uz izaicinājumiem un ierobežojumiem, daudzos gadījumos tomēr izmanto GPU skaitļošanas procesu paātrināšanai. Piemēram, diezgan tipiski superdatoros lieto vienā skaitļošanas mezglā četrus vai sešus GPU un vienu vai divus CPU. Ja salīdzinām pielietojumus, kuros izmantoti arī GPU vai tikai ar CPU, tad ar GPU iegūstam paātrinājumu 4-6 reizes, bet dažkārt pat 10 vairāk reižu.

GPU ir ļoti noderīgi tādos mašīnu mācīšanas pielietojumos kā neironu tīklu apmācība. Tas ir tāpēc, ka aritmētiskās skaitļošanas operācijas neironu tīklu apmācībā vairumā ir paralēlas un tāpēc ļoti piemērotas GPU. Tāpēc šādos uzdevumos GPU ir pat līdz 30 reižu ātrāks nekā CPU.


# Pašpārbaudes tests
**GPU (grafiskais skaitļošanas mezgls) ir galvenā komponente modernajos HPC. Lūdzu atzīmējiet pareizos formulējumus.**

**a)	GPU ir ļoti noderīgi tādos mašīnu mācīšanas pielietojumos kā neironu tīklu apmācība.**

**b) CPU ir sarežģītāks un plašāk lietojams nekā GPU.**

c)	Tuvākajā nākotnē superdatorus veidos tikai ar GPU, tāpēc, ka tie ir ar augstāku energoefektivitāti un darbojas efektīvāk nekā CPU.

**d)	Iegūt augstu efektivitāti no GPU ir programmētājam izaicinājums, jo ir jāņem vērā tā uzbūves īpatnības.**

e)	Līdz šim GPU nav plaši pieejami plaša patēriņa ierīcēs, taču superdatoru attīstība novedīs pie tā, ka GPU gūs pielietojumu arī personālajos datoros.
